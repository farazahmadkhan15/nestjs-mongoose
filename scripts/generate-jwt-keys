#!/bin/bash

# Check if required commands are available
if ! command -v openssl &> /dev/null; then
    echo "Error: openssl is not installed. Please install it first."
    exit 1
fi

# Generate RSA private key
openssl genrsa -out jwtRS256.key 2048

# Generate public key from private key
openssl rsa -in jwtRS256.key -pubout -outform PEM -out jwtRS256.key.pub

# Check OS to determine correct base64 command
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    PUBLIC_KEY_B64=$(base64 -i jwtRS256.key.pub | tr -d '\n')
    PRIVATE_KEY_B64=$(base64 -i jwtRS256.key | tr -d '\n')
else
    # Linux
    PUBLIC_KEY_B64=$(base64 -i -w 0 jwtRS256.key.pub)
    PRIVATE_KEY_B64=$(base64 -i -w 0 jwtRS256.key)
fi

echo -e "\e[32m\e[1mTo setup the JWT keys, please add the following values to your .env file:\e[0m"
echo "JWT_PUBLIC_KEY_BASE64=\"$PUBLIC_KEY_B64\""
echo "JWT_PRIVATE_KEY_BASE64=\"$PRIVATE_KEY_B64\""
echo ""
echo -e "\e[33m\e[1mGenerated files (you may remove these after adding to .env):\e[0m"
echo "- jwtRS256.key (private key)"
echo "- jwtRS256.key.pub (public key)"
